<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>

<muclient>
<plugin
   name="aard_damage_window"
   author="Sath/Claude"
   id="cca6d33b8bb93b7689a8e606"
   language="Lua"
   purpose="Tracks combat stats (damage, exp, gold, kills) in a rolling window."
   save_state="y"
   date_written="2025-12-31"
   requires="4.73"
   version="3.0"
   sequence="50"
   >
<description trim="y">
<![CDATA[
** Damage Tracker - Combat Stats Window
** Tracks damage given/taken, exp, gold, and kills in rolling 3-second buckets.

Commands:
  dt            - Show plugin status
  dt help       - Show all commands
  dt status     - Show plugin status
  dt show       - Show the tracker window
  dt hide       - Hide the tracker window
  dt echo       - Toggle echoing original lines to main window
  dt reset      - Reset all stats to zero
  dt rounds <n> - Set number of rounds to track (1-100, default 10)
  dt battlespam - Toggle combat effect messages (dodges, skills, etc.)
  dt debug      - Toggle debug mode
  dt reload     - Reload plugin
]]>
</description>

</plugin>

<include name="constants.lua"/>

<aliases>
	<alias
		match="^dt(?: (.*))?$"
		enabled="y"
		regexp="y"
		ignore_case="y"
		sequence="100"
		script="alias_dt"
	/>
</aliases>

<timers>
	<timer
		name="battle_tick"
		second="3"
		enabled="y"
		script="on_battle_tick"
	/>
</timers>

<triggers>
	<!-- Death message triggers to capture kills -->
	<trigger
		enabled="y"
		name="death_mob_mind"
		match="^(?!\()(?P&lt;mob&gt;.+) falls dead as \w+ mind is destroyed[^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_drain"
		match="^(?!\()(?P&lt;mob&gt;.+) howls as \w+ last spark of life is drained[^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_pale"
		match="^(?!\()(?P&lt;mob&gt;.+) turns deadly pale and collapses[^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_acid"
		match="^(?!\()(?P&lt;mob&gt;.+) screams in agony as the acid consumes [^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_holy"
		match="^(?!\()(?P&lt;mob&gt;.+) is damned forever by the holy power[^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_fire"
		match="^(?!\()(?P&lt;mob&gt;.+) screams as the flames engulf [^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_water"
		match="^(?!\()(?P&lt;mob&gt;.+) is battered to death by the force of the water[^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_earth"
		match="^(?!\()(?P&lt;mob&gt;.+) crumbles as \w+ is battered to death[^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_lightning"
		match="^(?!\()(?P&lt;mob&gt;.+) smoulders as the lightning destroys [^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_god"
		match="^The voice of god has cleansed (?P&lt;mob&gt;.+) eternally.+DEAD.+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_mindforce"
		match="^The mind force crushes (?P&lt;mob&gt;.+) into a bloody pulp.+DEAD.+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_desolate"
		match="^(?!\()(?P&lt;mob&gt;.+) feels so desolate that life itself leaves \w+ wrecked form.+DEAD[^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_fabric"
		match="^The very fabric of the world rejects (?P&lt;mob&gt;.+?) and .+ life is over.+DEAD.+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_letsout"
		match="^(?!\()(?P&lt;mob&gt;.+) lets out .+DEAD[^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_slain"
		match="^(?!\()(?P&lt;mob&gt;.+) is slain by a final [^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="110"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_dead"
		match="^(?!\()(?P&lt;mob&gt;.+).+DEAD[^']+$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="120"
		script="track"
	/>

	<!-- Experience trigger -->
	<trigger
		enabled="y"
		name="death_exp"
		match="^You(?: (don't))? receive ([\d\+]+)(?: 'rare kill')?(?: bonus)? experience (?:points?|bonus)(?: courtesy of .*| to celebrate .*| to rejoice in the death of another million mobs| in honor of .*| from your daily blessing)?[\.\!](?: \:\))?$"
		regexp="y"
		omit_from_output="y"
		sequence="101"
		script="track"
	/>

	<!-- Gold triggers -->
	<trigger
		enabled="y"
		name="death_gold"
		match="You get * gold coins from *."
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="death_gold_daily"
		match="Your daily blessing added * gold to the corpse."
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="death_sacrifice"
		match="^(.*) gives you (\d+) gold coins? for (.*)\.$"
		regexp="y"
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="death_split"
		match="You share * gold coins with * other *. Your share is * gold."
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="death_other_split"
		match="* shares * gold coins with *. Your share is * gold."
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="death_crumble"
		match="* crumbles into * gold pieces."
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<!-- Combat spam trigger - toggleable via dt battlespam -->
	<trigger
		enabled="y"
		name="combat_spam"
		match="^.* heals .*self\.$|^Acidic poison severely impairs your senses\.$|^.* fails to curse .*\.$|^.* entangled in an invisible web\.$|^.* web fails to take hold of .*\.$|^You can\'t see a thing\!$|^.* kicks? dirt in .* eyes\!$|^The stench is incredible\, you feel faint and weak\!$|^.* dazes? .*\, slamming into .* like a tank\.$|^It tears at your existence and you feel extremely vulnerable\.$|^.* hits? .* with a massive blow\, leaving .* stunned\!$|^.* dazes? .* with a mind\-numbing headbutt\!$|^The venom destroys your combat ability\. You feel dizzy\.$|^.* flesh is ripped from .* body\.$|^You feel your strength slip away\.$|^You are weak and BLIND\!$|^\* jumps? in to defend .*\!$|^.* exclaims? \'Your level is of no interest to me .*\; I will kill you anyway\!\'$|^.* says? \'Your purity sickens me\, .*\.\'$|^You block .* way as .* attempts? to flee\.$|^.* restores? life to .*self\.$|^You are shocked by .*\.$|^.* drains? life from .*\.$|^.* (try|tries) to disarm .*, but fails?\.$|^.* fails? to stun .* and .* in an attack\!$|^.* fails? to blind .*\.$|^.* fails to hex .*\!$|^.* slime tears at .* soul\!$|^.* begins to spin around\, flailing wildly\.$|^.* hurls? a barrage of searing white blades at .*\!$|^A black field of death emanates from .*\.$|^.* slams .* head sideways into .*\. OUCH\! That smarts\!$|^.* jams .* fingers into .* eyes, causing .* searing pain\.$|^.* chokes as .* breathes in the poison\.$|^.* sweeps your legs from under you\!$|^A deep aura of dread settles around .*\.$|^.* catch(es)? .* completely off-guard and inflicts? massive damage on .*\.$|^.* gets? a raged look in .* eyes\.$|^.* fails? to interfere with .* healing\.$|^.* screams? wildly and attacks? .*\.$|^.* with a series of hammering blows\!$|^.* black root smashes into you and you lose control of your senses\.$|^.* shoots? .* beam from .* hand straight towards .*\!$|^.* is poisoned by the venom on .*\.$|^.* raises .* and starts yelling KAI\-HA\!$|^.* yells KAI\-HA and then strikes .* torso\.$|^.* is frozen by .*\.$|^.* is burned by .*\.$|^.* eyes are seared by .*\.$|^.* spirit shield reflects .* back at .*\!$|^.* turns blue and shivers\.$|^.* gets a wild look in .* eyes\.$|^.* calls down rains of fire\!$|^.* screams? wildly and (try|tries) to cleave .* in half\!$|^A green mist emanates from .*\. The mist surrounds you\.$|^A green mist emanates from .* towards .*\.$|^.* a chilling cloud of ice\.$|^.* chants the phrase \'.*\'\.$|^.* bites .* on .* neck\.$|^.* hurls .* at .*, slamming into .* like a tank\.$|^\* breathes forth a huge blast of fire\.$|^.* calls the justice of .* to strike .* foes\!$|^.* fails to weaken .*\.$|^.* sprays .* with .*Kobold glands\.$|^.* failed to kick dirt into .* eyes\!$|^You feel a brief tingling sensation\.$|^.* sprays .* with acidic raven venom\.$|^.* touches .* with venomous hydra\'s blood\.$|^You feel momentarily ill\, but it passes\.$|^.* unleashes a blast of atomic energy on the room\.$|^.* smacks? .* with a solid uppercut\!$|^.* sends? .* sprawling with a powerful bash\!$|^.* conjures? a storm of freezing snow and sleet\.$|^.* tries to jump into the air\, realizes .* is already flying\, and kicks .* in the face instead\!$|^.* touch of nature heals .* wounds\.$|^You create a time shift and calmly step away from .* attack\.$|^You dodge .* attack\.$|^You are unaffected by .* dispel .*\.$|^You get lucky and manage to escape .* attack\.$|^You counter\-strike .* attack\!$|^You parry .* attack\.$|^You instinctively dodge .* attack\.$|^.* holy rift protects you from .* attack\.$|^You glow with energy as you absorb .*\.$|^You blink out of existence and avoid .* attack\.$|^You sense divine intervention as .* attack narrowly misses you\.$|^You misdirect .* attack\.$|^You blend perfectly with your surroundings and avoid .* attack\.$|^.* dodges? your attack\.$|^.* counter\-strikes your attack\!$|^.* parries your attack\.$|^.* misdirects your attack\.$|^.* holy rift protects .* from your attack\.$|^.* avoids your attack\, almost too easily\.$|^.* blocks your attack with .* shield\.$|^.* blends in perfectly causing .* to hit nothing but air\.$|^.* blinks out of existence avoiding your attack\.$|^.* fiddles with time and your attack is just a few seconds slow\.$|^.* shimmers momentarily\.$|^.* is shocked by .*\.$|^You are frozen by .*\.$|^.* muscles stop responding\.$|^You feel your blood being drained\!$|^Suddenly\, after performing an incantation\, .* disappears\.$|^.* tries to slow .* down but fails\.$|^.* reappears behind .* and stabs .* in the back\!$|^.* circles around .* and stabs .* in the back\!$|^.* forms a deadly cloud of poison\.$|^You feel a little run down\, but it passes\.$|^You feel .* drawing your life away\.$|^You feel a momentary chill on your neck\.$|^Your power grip is too strong for .*\.$|^Your head throbs as your reality is torn apart\!$|^.* uses the power of the cobra against .*\.$|^.* poison tears at .* skin\, .* eyes stream in agony\.$|^.* hammers? you with a series of blows!$|^(.*?) breathes forth a huge blast of fire\.$|^Unseen forces protect you from (.*?) tangling web\.$|^You slash at .* ferociously with your razor\-sharp claws\!$|^You lunge forward gnashing at .* viciously\.$|^You spitefully bite (.*?) as if (.*?) tried to pet you more than three times\.$|^You attempt to bury .* deep into .* back\!$|^.* spins around .*, catching .* off guard, and executes a vicious triple backstab\.$|^.* begins to spin around with .* weapon outstretched\.$|^You stretch out your weapon and begin to spin violently\!$"
		regexp="y"
		omit_from_output="n"
		sequence="100"
		script="spam_ignore"
	/>
</triggers>

<script>
<![CDATA[
dofile(GetPluginInfo(GetPluginID(), 20) .. "aard_damage_window_init.lua")
]]>
</script>

</muclient>
