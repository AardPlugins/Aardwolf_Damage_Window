<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>

<muclient>
<plugin
   name="Aardwolf_Damage_Window"
   author="Deathr"
   id="cca6d33b8bb93b7689a8e606"
   language="Lua"
   purpose="Tracks combat stats (damage, healing, exp, gold, kills) in a rolling window."
   save_state="y"
   date_written="2025-12-31"
   requires="4.73"
   version="1.0"
   sequence="50"
   >
<description trim="y">
<![CDATA[
** Damage Tracker - Combat Stats Window
** Tracks damage given/taken, healing, exp, gold, and kills with 1-second resolution.
** Display updates every second; "Now" shows live 3-second stats, "Sum" shows rolling total.

Commands:
  dt            - Show all commands (help)
  dt help       - Show all commands
  dt status     - Show plugin status
  dt show       - Show the tracker window
  dt hide       - Hide the tracker window
  dt echo       - Toggle echoing original lines to main window
  dt reset      - Reset all stats to zero
  dt rounds <n> - Set rounds for Sum column (1-300, each round=3s)
  dt battlespam - Toggle combat effect messages (dodges, skills, etc.)
  dt debug      - Toggle debug mode
  dt reload     - Reload plugin
]]>
</description>

</plugin>

<include name="constants.lua"/>

<aliases>
	<alias
		match="^dt(?: (.*))?$"
		enabled="y"
		regexp="y"
		ignore_case="y"
		sequence="100"
		script="alias_dt"
	/>
</aliases>

<timers>
	<timer
		name="battle_tick"
		second="1"
		enabled="y"
		script="on_battle_tick"
	/>
</timers>

<triggers>
	<!-- Death message triggers to capture kills -->
	<trigger
		enabled="y"
		name="death_mob_mind"
		match="^(?P<mob>[\w ',]+) falls dead as \w+ mind is destroyed.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_drain"
		match="^(?P<mob>[\w ',]+) howls as \w+ last spark of life is drained.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_pale"
		match="^(?P<mob>[\w ',]+) turns deadly pale and collapses.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_acid"
		match="^(?P<mob>[\w ',]+) screams in agony as the acid consumes .*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_holy"
		match="^(?P<mob>[\w ',]+) is damned forever by the holy power.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_fire"
		match="^(?P<mob>[\w ',]+) screams as the flames engulf .*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_water"
		match="^(?P<mob>[\w ',]+) is battered to death by the force of the water.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_earth"
		match="^(?P<mob>[\w ',]+) crumbles as \w+ is battered to death.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_lightning"
		match="^(?P<mob>[\w ',]+) smoulders as the lightning destroys .*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_god"
		match="^The voice of god has cleansed (?P<mob>.+) eternally.*DEAD.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_mindforce"
		match="^The mind force crushes (?P<mob>.+) into a bloody pulp.*DEAD.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_desolate"
		match="^(?P<mob>[\w ',]+) feels so desolate that life itself leaves \w+ wrecked form.*DEAD.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_fabric"
		match="^The very fabric of the world rejects .+ life is over.*DEAD.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_letsout"
		match="^(?P<mob>[\w ',]+) lets out .*DEAD.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="99"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_slain"
		match="^(?P<mob>[\w ',]+) is slain by a final .*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="110"
		script="track"
	/>
	<trigger
		enabled="y"
		name="death_mob_dead"
		match="^(?P<mob>[\w ',]+).*DEAD.*[^']$"
		regexp="y"
		ignore_case="y"
		omit_from_output="y"
		sequence="120"
		script="track"
	/>

	<!-- Experience trigger -->
	<trigger
		enabled="y"
		name="death_exp"
		match="^You(?: (don't))? receive ([\d\+]+)(?: 'rare kill')?(?: bonus)? experience (?:points?|bonus)(?: courtesy of .*| to celebrate .*| to rejoice in the death of another million mobs| in honor of .*| from your daily blessing)?[\.\!](?: \:\))?$"
		regexp="y"
		omit_from_output="y"
		sequence="101"
		script="track"
	/>

	<!-- Gold triggers -->
	<trigger
		enabled="y"
		name="death_gold"
		match="You get * gold coins from *."
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="death_gold_daily"
		match="Your daily blessing added * gold to the corpse."
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="death_sacrifice"
		match="^(.*) gives you (\d+) gold coins? for (.*)\.$"
		regexp="y"
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="death_split"
		match="You share * gold coins with * other *. Your share is * gold."
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="death_other_split"
		match="* shares * gold coins with *. Your share is * gold."
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="death_crumble"
		match="* crumbles into * gold pieces."
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<!-- Healing triggers -->
	<trigger
		enabled="y"
		name="heal_magic_touch"
		match="^You are .*healed by .* magic touch\. \[(\d+)\]$"
		regexp="y"
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

	<trigger
		enabled="y"
		name="heal_warm_feeling"
		match="^(?:\[\d+\] )?A warm feeling fills your body\. \[(\d+)\]$"
		regexp="y"
		omit_from_output="y"
		sequence="100"
		script="track"
	/>

</triggers>

<script>
<![CDATA[
dofile(GetPluginInfo(GetPluginID(), 20) .. "aardwolf_damage_window_init.lua")
]]>
</script>

</muclient>
